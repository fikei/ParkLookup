{\rtf1\ansi\ansicpg1252\cocoartf2867
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fnil\fcharset0 Menlo-Regular;}
{\colortbl;\red255\green255\blue255;\red255\green255\blue255;\red31\green31\blue36;}
{\*\expandedcolortbl;;\csgenericrgb\c100000\c100000\c100000;\csgenericrgb\c12054\c12284\c14131;}
\margl1440\margr1440\vieww11520\viewh8400\viewkind0
\deftab593
\pard\tx593\pardeftab593\partightenfactor0

\f0\fs24 \cf2 \cb3 === CLEANED DEBUG LOGS - Focused on Blockface Color Coding ===\
\
=== APP INITIALIZATION ===\
\uc0\u8505 \u65039  Google Maps SDK not installed. Map features will use placeholder.\
LocalZoneDataSource initialized\
ZoneRepository initialized\
Getting zones for city: sf\
Loaded 421 zones from disk cache in 507.0ms\
\uc0\u10003  Returning 421 zones from cache\
\
=== INITIAL LOCATION LOOKUP (Zone I - User's Home Zone) ===\
\uc0\u55357 \u56960  BUILD VERIFICATION: makeUIView called with 0 zones - DUPLICATE FIX ACTIVE\
Returning result with primary zone: I, confidence: medium\
\uc0\u55357 \u56589  ParkingDataAdapter.lookupParking at (37.759000, -122.423500)\
\
=== BLOCKFACE LOADING ATTEMPT #1 (CRITICAL - FILE NOT FOUND) ===\
\uc0\u55357 \u56549  Loading blockface dataset from sample_blockfaces_multiRPP_20251128.json (32MB)...\
sample_blockfaces_multiRPP_20251128.json not found in bundle\
\uc0\u10060  Failed to load blockfaces: The operation couldn't be completed. (SFParkingZoneFinder.BlockfaceLoaderError error 0.)\
\uc0\u10060  BlockfaceDataAdapter lookup failed: The operation couldn't be completed. (SFParkingZoneFinder.BlockfaceLoaderError error 0.)\
\uc0\u9888 \u65039  Blockface lookup failed, falling back to zone data\
\
=== FALLBACK TO ZONE DATA (Zone I) ===\
\uc0\u55357 \u56589  extractRegulationsFromZone: zone=Zone I, ruleCount=1\
\uc0\u9989  extractRegulationsFromZone: extracted 1 regulations\
  [0] type=residentialPermit, desc=Residential permit Zone I only\
\uc0\u55357 \u56589  ParkUntilCalculator.calculateParkUntil: validityStatus=multipleApply, regulationCount=1\
  [0] type=residentialPermit, desc=Residential permit Zone I only, enforcementDays=monday,tuesday,wednesday,thursday,friday,saturday\
\uc0\u9989  ParkUntilCalculator result: nil\
\
=== MAP VIEW SETUP WITH USER PERMIT ===\
\uc0\u55357 \u56960  BUILD VERIFICATION: makeUIView called with 421 zones - DUPLICATE FIX ACTIVE\
\uc0\u55357 \u56589  updateUIView called: overlaysLoaded=false, userPermitAreas=["I"], lastUserPermitAreas=[]\
\uc0\u55357 \u56589  Updating coordinator userPermitAreas: [] -> ["I"]\
\uc0\u55357 \u56525  User coordinate changed - recentering map to (37.759000, -122.423500)\
\uc0\u55356 \u57260  Initial overlay load: 421 zones (overlaysLoaded=false)\
\uc0\u55357 \u56615  loadOverlays called with shouldShowOverlays=true\
\uc0\u55357 \u56615  loadOverlays: initialized lastUserPermitAreas=["I"]\
  ... [110 multi-permit boundary matches - REMOVED FOR CLARITY] ...\
\
=== BLOCKFACE LOADING ATTEMPT #2 ===\
\uc0\u55357 \u56549  Loading blockface dataset from sample_blockfaces_multiRPP_20251128.json (32MB)...\
sample_blockfaces_multiRPP_20251128.json not found in bundle\
\uc0\u10060  Failed to load blockfaces for new region: fileNotFound\
\
=== MAP OVERLAY DISPLAY ===\
\uc0\u55357 \u56589  Deduplication: Total annotations before: 211\
\uc0\u9989  Deduplication: Unique annotations after: 211, removed 0 duplicates\
\uc0\u55357 \u56525  Zone polygons hidden (user setting)\
\uc0\u55357 \u56525  Initial load with blockface overlays enabled - centering on user location\
\uc0\u55356 \u56703 \u65039  Parking meters disabled (feature flag off)\
\uc0\u9989  Fade-in animation complete - overlays should be visible\
\
=== USER TAPS ZONE S LOCATION (Different from User's Zone I) ===\
\uc0\u55357 \u56525  Added tapped location dot at (37.757824, -122.425874)\
\uc0\u55357 \u56589  performLookupAt: (37.757824, -122.425874)\
Returning result with primary zone: S, confidence: medium\
\uc0\u9989  Zone found: Zone S (type: rpp)\
\uc0\u55357 \u56589  ParkingDataAdapter.lookupParking at (37.757824, -122.425874)\
\
=== BLOCKFACE LOADING ATTEMPT #3 (Still failing) ===\
\uc0\u55357 \u56549  Loading blockface dataset from sample_blockfaces_multiRPP_20251128.json (32MB)...\
sample_blockfaces_multiRPP_20251128.json not found in bundle\
\uc0\u10060  BlockfaceDataAdapter lookup failed: The operation couldn't be completed. (SFParkingZoneFinder.BlockfaceLoaderError error 0.)\
\uc0\u9888 \u65039  Blockface lookup failed, falling back to zone data\
\
=== FALLBACK TO ZONE DATA (Zone S) ===\
\uc0\u55357 \u56589  extractRegulationsFromZone: zone=Zone S, ruleCount=1\
\uc0\u9989  extractRegulationsFromZone: extracted 1 regulations\
  [0] type=residentialPermit, desc=Residential permit Zone S only\
\uc0\u55357 \u56589  ParkUntilCalculator.calculateParkUntil: validityStatus=invalid, regulationCount=1\
  [0] type=residentialPermit, desc=Residential permit Zone S only, enforcementDays=monday,tuesday,wednesday,thursday,friday,saturday\
\uc0\u55357 \u56589  Step 1: Checking street cleaning and no parking regulations...\
\uc0\u55357 \u56589  Step 2: Checking time limits for non-permit holders...\
  Found top-level time limit: 120 min\
\uc0\u9989  ParkUntilCalculator result: nil\
\
=== DATA SOURCE CHANGE EVENT ===\
\uc0\u55357 \u56785 \u65039  Blockface cache cleared\
\
=== KEY NOTES FOR DEBUGGING GREEN COLOR ===\
\
1. BLOCKFACE FILE MISSING: sample_blockfaces_multiRPP_20251128.json not in bundle\
   - Must rebuild app after adding file to Xcode project's Copy Bundle Resources\
   - Until file is present, NO blockface color coding will occur\
\
2. USER PERMIT DETECTED: userPermitAreas=["I"]\
   - User has Zone I permit\
   - When blockfaces load, Zone I streets should show GREEN\
\
3. COLOR CODING DEBUG OUTPUT (WILL APPEAR WHEN BLOCKFACES LOAD):\
   \
   EXAMPLE DEBUG OUTPUT FOR ZONE I STREET (What you should see):\
   ---------------------------------------------------------------\
   \uc0\u55357 \u56597  DEBUG POLYGON - Street: Buchanan St, Side: E\
     User permits: ["I"] -> uppercased: ["I"]\
     RPP regulation found:\
       permitZone: I\
       allPermitZones: ["I"]\
       \uc0\u10003  MATCH via permitZone!\
     parkUntilHours: 9999.0\
     -> Color: GREEN (user zone - permit holder has unlimited parking)\
   ---------------------------------------------------------------\
   \
   KEY FIELDS TO CHECK:\
   a) "User permits" - Should show ["I"] if user has Zone I permit\
   b) "RPP regulation found" - Shows permitZone and allPermitZones\
   c) "MATCH via permitZone" or "MATCH via allPermitZones" - Confirms permit match\
   d) "parkUntilHours" - Should be high number (9999.0) for unlimited\
   e) "Color: GREEN" - Final decision with reason\
\
4. DEBUGGING FAILURES (What went wrong):\
   \
   IF COLOR IS GREY INSTEAD OF GREEN:\
   - Check if "hasMeteredEnforced = true" appears before user zone check\
   - Verify "isUserZone = true" is set (should see MATCH log)\
   - Confirm priority 2 (GREEN) comes before priority 3 (GREY) in code\
   \
   IF COLOR IS ORANGE:\
   - Check "parkUntilHours" value - should be >24 for permit zones\
   - Verify user zone check happens (isUserZone = true)\
   - Look for time limit regulations that might override\
   \
   IF COLOR IS BLUE:\
   - Check if RPP regulation was found at all\
   - Verify "User permits" matches "permitZone" (case insensitive)\
   - Look for "allPermitZones" array in multi-RPP areas\
   \
   IF NO DEBUG OUTPUT:\
   - Street name not in debug list (Buchanan, Pine)\
   - Add your street to isDebugStreet check in BlockfaceMapOverlays.swift:250\
   - Example: let isDebugStreet = bf.street.contains("Buchanan") || bf.street.contains("Pine") || bf.street.contains("YourStreet")\
\
5. PRIORITY ORDER (from BlockfaceMapOverlays.swift):\
   - Priority 1: RED (no parking or active street cleaning)\
   - Priority 2: GREEN (user's permit zone - unlimited parking) <-- PERMIT TRUMPS METERED\
   - Priority 3: GREY (metered parking currently enforced)\
   - Priority 4: ORANGE (time limited <=24 hours)\
   - Priority 5: BLUE (no restrictions)\
\
6. MULTI-RPP ZONES (Zone I shares boundaries with S and Z):\
   - Zone I boundaries: ["I", "Z"] and ["I", "S"] in some areas\
   - Check "allPermitZones" array for multi-RPP streets\
   - Both permitZone AND allPermitZones are checked for matches\
   - Example log: "Multi-permit boundary matched: zone=I, boundaryIndex=51, validAreas=["I", "S"]"\
\
7. VERIFICATION STEPS AFTER REBUILD:\
   a) Rebuild app with blockface JSON in bundle\
   b) Launch app with Zone I permit configured\
   c) Check console for "Loading blockface dataset from sample_blockfaces_multiRPP_20251128.json"\
   d) Should see "Loaded X blockfaces in Y.YYs" NOT "not found in bundle"\
   e) Tap on Buchanan St or Pine St in Zone I area\
   f) Look for "DEBUG POLYGON" logs with color decision\
   g) Verify "Color: GREEN (user zone - permit holder has unlimited parking)"\
   h) Map overlay for that street should render GREEN (check visually)\
\
8. ADDITIONAL DEBUG STREETS:\
   To enable debug logging for your specific street, edit BlockfaceMapOverlays.swift:\
   - Line 250 (polygon): let isDebugStreet = bf.street.contains("YourStreet")\
   - Line 434 (polyline): let isDebugStreet = bf.street.contains("YourStreet")\
   This will print detailed color decision logic for that street.\
}
